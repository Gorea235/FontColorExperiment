function failedUpdate(n,t){logi("connection to server failed failed, status: "+t);alertError("Unable to connect to the server, please try again. If the problem persists, please contact an admin and give the follow message:\nSTATUS: "+t)}function checkStepFunc(n){return function(t){logd("received data "+JSON.stringify(t)+" from server");t.success?n():alertError("Unable to continue, please try again. If you have already seen this message, please contact an admin and give them this message:\n"+t.error.message)}}function nextStep(){startPostData("/api/experiment/user/step",checkStepFunc(beginReadyPage),failedUpdate,{id:userId()})}function clickError(){logi("attempting to re-fetch the page");window.location.reload()}function clickFinish(){logi("finishing experiment and clearing user");userIdReset();goUrl("/")}function clickSample(){logi("start user step push");nextStep()}function getQuestionAnswers(){for(var f,u,r={},i=JSON.parse($(_questionGroup).attr("data-questions")),t,n=0;n<i.length;n++){f=$("#question-"+i[n]);switch($(f).attr("data-questiontype")){case"0":if(t=$("input[name=question-"+i[n]+"]:checked").val(),logd("question "+i[n]+" value: "+t),t)r[i[n]]=parseInt(t);else return null;break;case"1":if(t=$("input[name=question-"+i[n]+"]:checked"),logd("question "+i[n]+" checked: "+t),!t)return null;for(u=[],n=0;n<t.length;n++)u.push(parseInt($(t[n]).val()));r[i[n]]=u;break;case"2":if(t=$("#question-select-"+i[n]).val(),logd("question "+i[n]+" value: "+t),t)r[i[n]]=parseInt(t);else return null;break;case"3":if(t=$("#question-text-"+i[n]).val(),logd("question "+i[n]+" value: "+t),t)r[i[n]]=t;else return null}}return logi("built question answers: "+JSON.stringify(r)),r}function clickQuestion(){logi("starting question submition and user step push");var n=getQuestionAnswers();n?startPostData("/api/experiment/user/answer",checkStepFunc(nextStep),failedUpdate,{id:userId(),answers:JSON.stringify(n)}):alertError("Please fill in all of the questions before continuing.")}function beginReadyPage(){userId()?startPostData("/api/experiment/view",setupPage,function(n,t){alertError("An error occured while loading the page. Please give an admin this message:\n"+t)},{id:userId()}):goUrl("/")}function setupPage(n){logi("setting up page information and events");displayData(_dispId,n);switch(currentDisplay){case 0:logd("error page loaded");break;case 1:$(_btnContinueId).attr("onclick","clickError()").prop("disabled",!0);setTimeout(function(){$(_btnContinueId).removeAttr("disabled")},5e3);$(_btnContinueId).attr("onclick","clickFinish()");logd("finish page loaded");break;case 2:$(_btnContinueId).attr("onclick","clickSample()");logd("sample page loaded");break;case 3:$(_btnContinueId).attr("onclick","clickQuestion()");logd("question page loaded")}}var currentDisplay=0,_dispId="#experimentDisplay",_btnContinueId="#btnContinue",_questionGroup="#questionGroup";$(document).ready(beginReadyPage);